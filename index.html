<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Адмінка: Авто-рух та слід</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: sans-serif; overflow: hidden; background: #000; }
        #map { height: 100vh; width: 100vw; z-index: 1; }
        
        .panel { 
            position: absolute; top: 10px; right: 10px; z-index: 1000; 
            background: rgba(255, 255, 255, 0.9); padding: 10px; 
            border-radius: 8px; display: flex; flex-direction: column; gap: 5px; 
            border: 1px solid #333; width: 150px;
        }
        
        .btn { 
            cursor: pointer; padding: 8px; font-weight: bold; font-size: 11px; 
            border: 1px solid #999; background: #fff; text-align: left;
            display: flex; align-items: center; gap: 5px;
        }
        .btn:hover { background: #eee; }
        .btn img { width: 16px; height: 16px; }
    </style>
</head>
<body>

    <div class="panel">
        <div class="btn" onclick="selectType('shahed', 'shahed.png')">
            <img src="shahed.png"> Shahed
        </div>
        
        <div class="btn" onclick="selectType('supercam', 'supercam.png')">
            <img src="supercam.png"> Суперкам
        </div>
        
        <div class="btn" onclick="selectType('zala', 'zala.png')">
            <img src="zala.png"> Зала
        </div>
        
        <div class="btn" onclick="selectType('orlan', 'orlan.png')">
            <img src="orlan.png"> Орлан
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', { zoomControl: false }).setView([48.37, 31.16], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let selectedType = null;
        let selectedIcon = null;
        let currentUnit = null;
        let units = [];

        const METER_LAT = 111111;

        function selectType(type, icon) {
            selectedType = type;
            selectedIcon = icon;
        }

        map.on('click', (e) => {
            if (!selectedType) return;

            if (!currentUnit) {
                // Крок 1: Створюємо маркер у точці кліку
                const unitId = Date.now();
                const icon = L.icon({
                    iconUrl: selectedIcon,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                });

                const marker = L.marker(e.latlng, { icon: icon }).addTo(map);
                
                // Створюємо пунктирний вектор
                const vector = L.polyline([e.latlng, e.latlng], {
                    color: '#333', weight: 2, dashArray: '5, 10', opacity: 0.5
                }).addTo(map);

                // Створюємо червоний слід
                const trail = L.polyline([e.latlng], {
                    color: 'red', weight: 3, opacity: 0.6
                }).addTo(map);

                currentUnit = {
                    id: unitId,
                    type: selectedType,
                    marker: marker,
                    vector: vector,
                    trail: trail,
                    pos: e.latlng,
                    history: [e.latlng],
                    angle: 0,
                    speed: 150,
                    moving: false
                };
                
                units.push(currentUnit);
            } else {
                // Крок 2: Другий клік задає кут
                const start = currentUnit.pos;
                const end = e.latlng;
                
                const angleRad = Math.atan2(end.lng - start.lng, end.lat - start.lat);
                const angleDeg = angleRad * 180 / Math.PI;
                const uAngle = (angleDeg + 360) % 360;

Данил, [20.02.2026 15:31]
currentUnit.angle = uAngle;
                
                // Повертаємо іконку
                const markerImg = currentUnit.marker.getElement();
                if (markerImg) {
                    markerImg.style.transform +=  rotate(${uAngle}deg);
                }
                
                currentUnit.moving = true; // Запускаємо рух
                currentUnit = null;
            }
        });

        // Головний цикл руху
        setInterval(() => {
            units.forEach(u => {
                if (!u.moving) return;

                const step = (u.speed / 3.6) * 0.1; 
                const rad = u.angle * Math.PI / 180;
                const curr = u.marker.getLatLng();

                const dLat = (step * Math.cos(rad)) / METER_LAT;
                const dLng = (step * Math.sin(rad)) / (METER_LAT * Math.cos(curr.lat * Math.PI / 180));

                const newPos = L.latLng(curr.lat + dLat, curr.lng + dLng);

                u.pos = newPos;
                u.marker.setLatLng(newPos);
                
                u.history.push(newPos);
                u.trail.setLatLngs(u.history);

                const vPts = u.vector.getLatLngs();
                const diffLat = newPos.lat - vPts[0].lat;
                const diffLng = newPos.lng - vPts[0].lng;
                u.vector.setLatLngs(vPts.map(p => L.latLng(p.lat + diffLat, p.lng + diffLng)));
            });
        }, 100);
    </script>
</body>
</html>
