<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω–∫–∞ –Ñ—Ü—ñ–ª—å</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; }
        #map { height: 100vh; width: 100vw; }
        .panel { 
            position: absolute; top: 10px; right: 10px; z-index: 1000; 
            background: rgba(255, 255, 255, 0.9); padding: 10px; border-radius: 8px;
            display: flex; flex-direction: column; gap: 5px; width: 160px;
        }
        .btn { 
            cursor: pointer; padding: 8px; font-weight: bold; font-size: 11px; 
            border: 1px solid #999; background: #fff; display: flex; align-items: center; gap: 5px;
        }
        .btn img { width: 20px; height: 20px; }
        .btn.active { background: #ff4444; color: white; }
        .unit-icon { width: 32px; height: 32px; }
    </style>
</head>
<body>

    <div class="panel">
        <button class="btn" onclick="setMode('sh', 's1.png')"><img src="s1.png"> –®–ê–•–ï–î</button>
        <button class="btn" onclick="setMode('zala', 'https://image2url.com/r2/default/images/1769866607142-afcdd360-ecda-4262-b039-d4bb7969d62f.png')"><img src="https://image2url.com/r2/default/images/1769866607142-afcdd360-ecda-4262-b039-d4bb7969d62f.png"> ZALA</button>
        <button class="btn" onclick="setMode('orlan', 'https://image2url.com/r2/default/images/1770670326543-8141ee72-84e1-4407-b42a-ec65d4df9ca2.png')"><img src="https://image2url.com/r2/default/images/1770670326543-8141ee72-84e1-4407-b42a-ec65d4df9ca2.png"> –û–†–õ–ê–ù-10</button>
        <button class="btn" onclick="setMode('kb', 'kab.png')"><img src="kab.png"> –ö–ê–ë</button>
        <hr>
        <button class="btn" style="color:red" onclick="setMode('del', '')">üóëÔ∏è –í–ò–î–ê–õ–ò–¢–ò</button>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', { zoomControl: false }).setView([48.37, 31.16], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let activeMode = null, activeIcon = '', currentUnit = null, units = [];

        function setMode(mode, icon) {
            activeMode = mode; activeIcon = icon; currentUnit = null;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            if(event) event.currentTarget.classList.add('active');
        }

        map.on('click', (e) => {
            if (activeMode === 'del') return;
            if (activeIcon && !currentUnit) {
                const iconHTML = L.divIcon({
                    className: 'u-wrap',
                    html: <img src="${activeIcon}" class="unit-icon" style="transform: rotate(0deg);">,
                    iconSize: [32, 32], iconAnchor: [16, 16]
                });
                const marker = L.marker(e.latlng, { icon: iconHTML }).addTo(map);
                const u = { id: Date.now(), marker, pos: e.latlng, angle: 0, moving: false };
                marker.on('click', (ev) => {
                    L.DomEvent.stopPropagation(ev);
                    if(activeMode === 'del') { map.removeLayer(marker); units = units.filter(x => x.id !== u.id); }
                    else { currentUnit = u; }
                });
                units.push(u); currentUnit = u;
            } else if (currentUnit) {
                const target = e.latlng;
                const angle = Math.atan2(target.lng - currentUnit.pos.lng, target.lat - currentUnit.pos.lat) * (180 / Math.PI);
                const img = currentUnit.marker.getElement().querySelector('img');
                if(img) img.style.transform = rotate(${angle}deg);
                currentUnit = null;
            }
        });
    </script>
</body>
</html>
